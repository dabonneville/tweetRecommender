<html>
  <head>
    <title>Tweet Recommender</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/static/css/custom.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/ICanHaz.js"></script>


    <script id="selectorOption" type="text/html">
      <option>{{name}}</option>
    </script>

    <script id="checkOption" type="text/html">
      <input type="checkbox" class="checkoption" name="{{ name }}" value="{{ name }}">{{ name }}<br>
    </script>

    <script id="optionset" type="text/html">
      <div class="optionset">
        <form class="gatheringMethods">
          <h4>gathering</h4>
          <select class="gatheringMethodSelector" name="gatheringMethodSelector"></select>
        </form>
        <form class="filteringMethods">
          <h4>filtering</h4>
        </form>
        <form class="rankingMethods">
          <h4>ranking</h4>
        </form>
      </div>
    </script>

    <script id="resultlist" type="text/html">
    <div class="resultlist"></div>
// methods, precision, recall, #tweets processed
    </script>

    <script id ="tweet" type="text/html">
      <div class="tweet">
        <div class="tweet-header">
          <span class="tweet-author">{{ username }}</span>
          <span class="tweet-date">{{ date }}</span>
          <span class="badge badge-info">{{ score }}</span>
        </div>
        <p class="tweet-body">{{ text }}</p>
      </div>
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
        <!-- Part 1: Wrap all page content here -->
    <div id="wrap">

      <!-- Fixed navbar -->
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/">TweetRecommender</a>
          </div>
        </div>
      </div>

      <!-- Begin page content -->
      <div class="container">
        <div class="search">
          <h3>Find relevant tweets for news</h3>
          <input type="text" id="searchbar" placeholder="Insert url..." class="input-large" name="url" />
          <div class="center">
            <button type="submit" id="searchbutton" class="btn" name="action" value="search">Search</button>
            <button type="submit" id="randombutton" class="btn" name="action" value="random">Random article</button>
            <button type="submit" id="advancedbutton" class="btn" name="action" value="advanced">Options</button>
          </div>
        </div>
      </div>

      <div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">Masterproject summer term 2014 at <a href="https://www.hpi.uni-potsdam.de/willkommen.html" target="_blank">HPI Potsdam</a> "Finding relevant tweets for news". Find us <a href="https://github.com/lesnail/tweetRecommender" target="_blank">@github</a>.</p>
      </div>
    </div>
  <script type="text/javascript">
    var processRanking = function(data, textStatus, jqXHR) {
        console.log(data.tweets.length);
        for(var i = 0; i < data.tweets.length; i++) {
          var tweet = data.tweets[i][1];
          var score = data.tweets[i][0];
          var tweetData = {
            "username": tweet["user"]["screen_name"],
            "score": score,
            "text": tweet["text"],
            "date": tweet["created_at"]
          };
          
          var tweetHTML = ich.tweet(tweetData);
          $(".search").append(tweetHTML);
        }
      }

    var readOptions = function(optionSet){
      var result = {
        "filteringMethods": [],
        "rankingMethods": []
      };
      result["gatheringMethod"] = $(optionSet).find(".gatheringMethods").serializeArray()[0].value;
      var selectedFilteringMethods = $(optionSet).find(".filteringMethods").serializeArray();
      for(var i = 0; i < selectedFilteringMethods.length; i++){
        result["filteringMethods"].push(selectedFilteringMethods[i].value);
      }
      var selectedRankingMethods = $(optionSet).find(".rankingMethods").serializeArray();
      for(var i = 0; i < selectedRankingMethods.length; i++){
        result["rankingMethods"].push(selectedRankingMethods[i].value);
      }
      return result;
    }

    $("#randombutton").click(function(){
      $(".tweet").remove();
      var options = readOptions($(".optionset")[0]);
      options["action"] = "random";
      $.ajax("query", {"type": "POST", "contentType": "application/json", "dataType": "json", "data": JSON.stringify(options), "success": processRanking});
    });

    $("#advancedbutton").click(function(){
      $(".optionset").toggleClass("hidden");
    });
  </script>
  <script type="text/javascript">
    $(document).ready(function () {
      createOptionSet = function(){
        var optionSet = ich.optionset({});

        for(var i = 0; i < gatheringMethods.length; i++){
          var option = ich.selectorOption({"name": gatheringMethods[i]});
          $(optionSet).find(".gatheringMethodSelector").append(option);
        }

        for(var i = 0; i < filteringMethods.length; i++){
          var option = ich.checkOption({"name": filteringMethods[i]});
          $(optionSet).find(".filteringMethods").append(option);
        }

        for(var i = 0; i < rankingMethods.length; i++){
          var option = ich.checkOption({"name": rankingMethods[i]});
          $(optionSet).find(".rankingMethods").append(option);
        }

        //setting defaults
        $(optionSet).find(".rankingMethods").find("[name='follower_count']").prop("checked", true);
        $(optionSet).find(".filteringMethods").find("[name='expected_time']").prop("checked", true);

        return optionSet
      }

      $.ajax("options", {"success": function(data, textStatus, jqXHR){
        gatheringMethods = data["gatheringMethods"];
        rankingMethods = data["rankingMethods"];
        filteringMethods = data["filteringMethods"];

        $(".search").append(createOptionSet().addClass("hidden"));
      }});

    });
  </script>
  </body>
</html>